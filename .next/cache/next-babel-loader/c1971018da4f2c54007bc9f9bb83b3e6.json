{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { default as NextApp } from \"next/app\";\nimport axios from \"axios\";\nimport firebase from \"../firebase.js\";\nimport redirect from \"../utils/redirect\";\nimport Base from \"../components/base\";\n\nvar App =\n/*#__PURE__*/\nfunction (_NextApp) {\n  _inherits(App, _NextApp);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      user: _this.props.user\n    });\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      firebase.auth().onAuthStateChanged(\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(user) {\n          var token;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!user) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  _this2.setState({\n                    user: user\n                  });\n\n                  _context.prev = 2;\n                  _context.next = 5;\n                  return user.getIdToken();\n\n                case 5:\n                  token = _context.sent;\n                  _context.next = 8;\n                  return axios.post(\"/api/login\", {\n                    token: token\n                  });\n\n                case 8:\n                  return _context.abrupt(\"return\", _context.sent);\n\n                case 11:\n                  _context.prev = 11;\n                  _context.t0 = _context[\"catch\"](2);\n                  console.log(_context.t0);\n\n                case 14:\n                  _context.next = 19;\n                  break;\n\n                case 16:\n                  _this2.setState({\n                    user: null\n                  });\n\n                  _context.next = 19;\n                  return axios.post(\"/api/logout\");\n\n                case 19:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[2, 11]]);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          Component = _this$props.Component,\n          pageProps = _this$props.pageProps;\n      var user = this.state.user;\n      return __jsx(React.Fragment, null, __jsx(Base, null), __jsx(Component, _extends({\n        user: user\n      }, pageProps)));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(appContext) {\n        var _appContext$ctx, req, res, asPath, auth, user, appProps;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _appContext$ctx = appContext.ctx, req = _appContext$ctx.req, res = _appContext$ctx.res, asPath = _appContext$ctx.asPath;\n                auth = firebase.auth();\n                user = req && req.session ? req.session.decodedToken : auth.currentUser;\n                if (user && asPath === \"/\") redirect(\"/account/\".concat(user.uid), res);\n                if (!user && asPath !== \"/\") redirect(\"/\", res);\n                _context2.next = 7;\n                return NextApp.getInitialProps(appContext);\n\n              case 7:\n                appProps = _context2.sent;\n                return _context2.abrupt(\"return\", _objectSpread({\n                  user: user\n                }, appProps));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function getInitialProps(_x2) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return App;\n}(NextApp);\n\nexport { App as default };","map":{"version":3,"sources":["/Users/patrick/Development/highway/pages/_app.js"],"names":["React","default","NextApp","axios","firebase","redirect","Base","App","user","props","auth","onAuthStateChanged","setState","getIdToken","token","post","console","log","Component","pageProps","state","appContext","ctx","req","res","asPath","session","decodedToken","currentUser","uid","getInitialProps","appProps"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAO,IAAIC,OAApB,QAAmC,UAAnC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP;AACA,OAAOC,QAAP;AACA,OAAOC,IAAP;;IAEqBC,G;;;;;;;;;;;;;;;;;;4DAaX;AAAEC,MAAAA,IAAI,EAAE,MAAKC,KAAL,CAAWD;AAAnB,K;;;;;;;wCAEY;AAAA;;AAClBJ,MAAAA,QAAQ,CAACM,IAAT,GAAgBC,kBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA,iCAAmC,iBAAMH,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAC7BA,IAD6B;AAAA;AAAA;AAAA;;AAE/B,kBAAA,MAAI,CAACI,QAAL,CAAc;AAAEJ,oBAAAA,IAAI,EAAJA;AAAF,mBAAd;;AAF+B;AAAA;AAAA,yBAITA,IAAI,CAACK,UAAL,EAJS;;AAAA;AAIvBC,kBAAAA,KAJuB;AAAA;AAAA,yBAKhBX,KAAK,CAACY,IAAN,CAAW,YAAX,EAAyB;AAAED,oBAAAA,KAAK,EAALA;AAAF,mBAAzB,CALgB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAO7BE,kBAAAA,OAAO,CAACC,GAAR;;AAP6B;AAAA;AAAA;;AAAA;AAU/B,kBAAA,MAAI,CAACL,QAAL,CAAc;AAAEJ,oBAAAA,IAAI,EAAE;AAAR,mBAAd;;AAV+B;AAAA,yBAWzBL,KAAK,CAACY,IAAN,CAAW,aAAX,CAXyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAnC;;AAAA;AAAA;AAAA;AAAA;AAcD;;;6BAEQ;AAAA,wBAC0B,KAAKN,KAD/B;AAAA,UACCS,SADD,eACCA,SADD;AAAA,UACYC,SADZ,eACYA,SADZ;AAAA,UAECX,IAFD,GAEU,KAAKY,KAFf,CAECZ,IAFD;AAGP,aACE,4BACE,MAAC,IAAD,OADF,EAEE,MAAC,SAAD;AAAW,QAAA,IAAI,EAAEA;AAAjB,SAA2BW,SAA3B,EAFF,CADF;AAMD;;;;;;iDAxC4BE,U;;;;;;;kCAGvBA,U,CADFC,G,EAAOC,G,mBAAAA,G,EAAKC,G,mBAAAA,G,EAAKC,M,mBAAAA,M;AAEbf,gBAAAA,I,GAAON,QAAQ,CAACM,IAAT,E;AACPF,gBAAAA,I,GAAOe,GAAG,IAAIA,GAAG,CAACG,OAAX,GAAqBH,GAAG,CAACG,OAAJ,CAAYC,YAAjC,GAAgDjB,IAAI,CAACkB,W;AAClE,oBAAIpB,IAAI,IAAIiB,MAAM,KAAK,GAAvB,EAA4BpB,QAAQ,oBAAaG,IAAI,CAACqB,GAAlB,GAAyBL,GAAzB,CAAR;AAC5B,oBAAI,CAAChB,IAAD,IAASiB,MAAM,KAAK,GAAxB,EAA6BpB,QAAQ,CAAC,GAAD,EAAMmB,GAAN,CAAR;;uBACNtB,OAAO,CAAC4B,eAAR,CAAwBT,UAAxB,C;;;AAAjBU,gBAAAA,Q;;AACGvB,kBAAAA,IAAI,EAAJA;mBAASuB,Q;;;;;;;;;;;;;;;;;;;EAVW7B,O;;SAAZK,G","sourcesContent":["import React from \"react\"\nimport { default as NextApp } from \"next/app\"\nimport axios from \"axios\"\nimport firebase from \"firebase-client\"\nimport redirect from \"utils/redirect\"\nimport Base from \"components/base\"\n\nexport default class App extends NextApp {\n  static async getInitialProps(appContext) {\n    const {\n      ctx: { req, res, asPath }\n    } = appContext\n    const auth = firebase.auth()\n    const user = req && req.session ? req.session.decodedToken : auth.currentUser\n    if (user && asPath === \"/\") redirect(`/account/${user.uid}`, res)\n    if (!user && asPath !== \"/\") redirect(\"/\", res)\n    const appProps = await NextApp.getInitialProps(appContext)\n    return { user, ...appProps }\n  }\n\n  state = { user: this.props.user }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(async user => {\n      if (user) {\n        this.setState({ user })\n        try {\n          const token = await user.getIdToken()\n          return await axios.post(\"/api/login\", { token })\n        } catch (err) {\n          console.log(err)\n        }\n      } else {\n        this.setState({ user: null })\n        await axios.post(\"/api/logout\")\n      }\n    })\n  }\n\n  render() {\n    const { Component, pageProps } = this.props\n    const { user } = this.state\n    return (\n      <>\n        <Base />\n        <Component user={user} {...pageProps} />\n      </>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}