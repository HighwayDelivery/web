{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { default as NextApp } from \"next/app\";\nimport axios from \"axios\";\nimport firebase from \"../firebase.js\";\nimport redirect from \"../utils/redirect\";\nimport Base from \"../components/base\";\nexport default class App extends NextApp {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      user: this.props.user\n    });\n  }\n\n  static async getInitialProps(appContext) {\n    const {\n      ctx: {\n        req,\n        res,\n        asPath\n      }\n    } = appContext;\n    const auth = firebase.auth();\n    const user = req && req.session ? req.session.decodedToken : auth.currentUser;\n    if (user && asPath === \"/\") redirect(`/account/${user.uid}`, res);\n    if (!user && asPath !== \"/\") redirect(\"/\", res);\n    const appProps = await NextApp.getInitialProps(appContext);\n    return _objectSpread({\n      user\n    }, appProps);\n  }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(async user => {\n      if (user) {\n        this.setState({\n          user\n        });\n\n        try {\n          const token = await user.getIdToken();\n          return await axios.post(\"/api/login\", {\n            token\n          });\n        } catch (err) {\n          console.log(err);\n        }\n      } else {\n        this.setState({\n          user: null\n        });\n        await axios.post(\"/api/logout\");\n      }\n    });\n  }\n\n  render() {\n    const {\n      Component,\n      pageProps\n    } = this.props;\n    const {\n      user\n    } = this.state;\n    return __jsx(React.Fragment, null, __jsx(Base, null), __jsx(Component, _extends({\n      user: user\n    }, pageProps)));\n  }\n\n}","map":{"version":3,"sources":["/Users/patrick/Development/highway/pages/_app.js"],"names":["React","default","NextApp","axios","firebase","redirect","Base","App","user","props","getInitialProps","appContext","ctx","req","res","asPath","auth","session","decodedToken","currentUser","uid","appProps","componentDidMount","onAuthStateChanged","setState","token","getIdToken","post","err","console","log","render","Component","pageProps","state"],"mappings":";;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAO,IAAIC,OAApB,QAAmC,UAAnC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP;AACA,OAAOC,QAAP;AACA,OAAOC,IAAP;AAEA,eAAe,MAAMC,GAAN,SAAkBL,OAAlB,CAA0B;AAAA;AAAA;;AAAA,mCAa/B;AAAEM,MAAAA,IAAI,EAAE,KAAKC,KAAL,CAAWD;AAAnB,KAb+B;AAAA;;AACvC,eAAaE,eAAb,CAA6BC,UAA7B,EAAyC;AACvC,UAAM;AACJC,MAAAA,GAAG,EAAE;AAAEC,QAAAA,GAAF;AAAOC,QAAAA,GAAP;AAAYC,QAAAA;AAAZ;AADD,QAEFJ,UAFJ;AAGA,UAAMK,IAAI,GAAGZ,QAAQ,CAACY,IAAT,EAAb;AACA,UAAMR,IAAI,GAAGK,GAAG,IAAIA,GAAG,CAACI,OAAX,GAAqBJ,GAAG,CAACI,OAAJ,CAAYC,YAAjC,GAAgDF,IAAI,CAACG,WAAlE;AACA,QAAIX,IAAI,IAAIO,MAAM,KAAK,GAAvB,EAA4BV,QAAQ,CAAE,YAAWG,IAAI,CAACY,GAAI,EAAtB,EAAyBN,GAAzB,CAAR;AAC5B,QAAI,CAACN,IAAD,IAASO,MAAM,KAAK,GAAxB,EAA6BV,QAAQ,CAAC,GAAD,EAAMS,GAAN,CAAR;AAC7B,UAAMO,QAAQ,GAAG,MAAMnB,OAAO,CAACQ,eAAR,CAAwBC,UAAxB,CAAvB;AACA;AAASH,MAAAA;AAAT,OAAkBa,QAAlB;AACD;;AAIDC,EAAAA,iBAAiB,GAAG;AAClBlB,IAAAA,QAAQ,CAACY,IAAT,GAAgBO,kBAAhB,CAAmC,MAAMf,IAAN,IAAc;AAC/C,UAAIA,IAAJ,EAAU;AACR,aAAKgB,QAAL,CAAc;AAAEhB,UAAAA;AAAF,SAAd;;AACA,YAAI;AACF,gBAAMiB,KAAK,GAAG,MAAMjB,IAAI,CAACkB,UAAL,EAApB;AACA,iBAAO,MAAMvB,KAAK,CAACwB,IAAN,CAAW,YAAX,EAAyB;AAAEF,YAAAA;AAAF,WAAzB,CAAb;AACD,SAHD,CAGE,OAAOG,GAAP,EAAY;AACZC,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,OARD,MAQO;AACL,aAAKJ,QAAL,CAAc;AAAEhB,UAAAA,IAAI,EAAE;AAAR,SAAd;AACA,cAAML,KAAK,CAACwB,IAAN,CAAW,aAAX,CAAN;AACD;AACF,KAbD;AAcD;;AAEDI,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEC,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAA2B,KAAKxB,KAAtC;AACA,UAAM;AAAED,MAAAA;AAAF,QAAW,KAAK0B,KAAtB;AACA,WACE,4BACE,MAAC,IAAD,OADF,EAEE,MAAC,SAAD;AAAW,MAAA,IAAI,EAAE1B;AAAjB,OAA2ByB,SAA3B,EAFF,CADF;AAMD;;AAzCsC","sourcesContent":["import React from \"react\"\nimport { default as NextApp } from \"next/app\"\nimport axios from \"axios\"\nimport firebase from \"firebase-client\"\nimport redirect from \"utils/redirect\"\nimport Base from \"components/base\"\n\nexport default class App extends NextApp {\n  static async getInitialProps(appContext) {\n    const {\n      ctx: { req, res, asPath }\n    } = appContext\n    const auth = firebase.auth()\n    const user = req && req.session ? req.session.decodedToken : auth.currentUser\n    if (user && asPath === \"/\") redirect(`/account/${user.uid}`, res)\n    if (!user && asPath !== \"/\") redirect(\"/\", res)\n    const appProps = await NextApp.getInitialProps(appContext)\n    return { user, ...appProps }\n  }\n\n  state = { user: this.props.user }\n\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(async user => {\n      if (user) {\n        this.setState({ user })\n        try {\n          const token = await user.getIdToken()\n          return await axios.post(\"/api/login\", { token })\n        } catch (err) {\n          console.log(err)\n        }\n      } else {\n        this.setState({ user: null })\n        await axios.post(\"/api/logout\")\n      }\n    })\n  }\n\n  render() {\n    const { Component, pageProps } = this.props\n    const { user } = this.state\n    return (\n      <>\n        <Base />\n        <Component user={user} {...pageProps} />\n      </>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}